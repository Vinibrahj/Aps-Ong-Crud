
@{
    ViewBag.Title = "Cadastro de Funcionário";
}

<h2>Cadastro Teste</h2>

<a class="btn btn-success" style="margin-bottom:10px" onclick="PopUpForm('@Url.Action("AddOrEdit", "Funcionario")')"><i class="fas fa-plus"></i> Add New</a>
<table id="FuncTable" class="table table-striped table-bordered" style="width:100%">
    <thead>
        <tr>
            <th>Nome</th>
            <th>Cargo</th>
            <th>Sede</th>
            <th>Idade</th>
            <th>Salario</th>
        </tr>
    </thead>
</table>

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap.min.css" rel="stylesheet" />


@section scripts{
        <script src="//cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap.min.js"></script>
        <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" data-auto-replace-svg="nest"></script>
        <script>
            var Popup, dataTable;
            $(document).ready(function () { // Função ajax pra popular a tabela quando a página abrir
               dataTable =  $("#FuncTable").DataTable({
                    "ajax": {
                        "url": "/Funcionario/GetData",
                        "type": "GET",
                        "datatype": "json"
                    },
                    "columns": [
                        { "data": "Nome" },
                        { "data": "Cargo" },
                        { "data": "Sede" },
                        { "data": "Idade" },
                        { "data": "Salario" }
                    ],
                    "language": {

                        "emptyTable" : "Não há dados disponíveis."
                    }
                });
            });

            function PopUpForm(url) {
                var formDiv = $('<div/>');
                $.get(url)
                    .done(function (response) {
                        formDiv.html(response);

                        Popup = formDiv.dialog({
                            autoOpen: true,
                            resizable: false,
                            title: 'Preencha os dados do funcionário',
                            height: 700,
                            width: 700,
                            close: function () {
                                Popup.dialog('destroy').remove();
                            }
                        });
                    });
            }

            function SubmitForm(form) {
                $.ajax({
                    type: "POST",
                    url: form.action,
                    data: $(form).serialize(),
                    success: function (data) {
                        if (data.success) {
                            Popup.dialog('close');
                            dataTable.ajax.reload();
                        }
                    }
                });
                return false;
            }
        </script>
    }

